/*
 *  JavaScript FBplus Badge 
 *  https://github.com/shtange/FBplus
 *
 *  Copyright 2014, Yurii Shtanhei
 *  site: http://shtange.com/FBplus/
 *  google+: https://plus.google.com/+YuriiShtanhei
 *  habr: http://habrahabr.ru/users/shtange/
 *  email: y.shtanhei@gmail.com
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/MIT
 */
 
(function(){var e=function(){this.badge=document.getElementById("FBplusBadge");this.bdata={minwidth:160,maxwidth:420,deflang:"en",descrlen:240};this.udata={width:240,href:"",theme:"light",lang:"en_EN",font:"Tahoma"};this.fblang={en:"en_US",de:"de_DE",fr:"fr_FR",it:"it_IT",es:"es_ES",pt:"pt_PT",ru:"ru_RU",ua:"uk_UA"};this.fbdata=[];this.tmpl={}};e.prototype={load:function(){this.getUserSettings();this.getFacebookData();this.setBadgeTheme()},getUserSettings:function(){var e=this.badge,t=this.udata;for(var n in t){t[n]=e.getAttribute("data-"+n)}this.udata=this.validateUserData(e,t)},validateUserData:function(e,t){var n,r,i,s,o;for(var u in t){switch(u){case"width":n=parseInt(e.getAttribute("data-"+u));n=n&&n<this.bdata.minwidth?this.bdata.minwidth:n;n=n&&n>this.bdata.maxwidth?this.bdata.maxwidth:n;t[u]=n?n:this.udata.width;break;case"href":r=e.getAttribute("data-"+u);t[u]=r?r.substring(r.lastIndexOf("/")+1):this.udata.href;break;case"theme":i=e.getAttribute("data-"+u);t[u]=i=="light"||i=="dark"?i:this.udata.theme;break;case"lang":s=e.getAttribute("data-"+u);s=this.fblang[s]&&this.fblang[s].length>0?s:this.bdata.deflang;t[u]=this.fblang[s];t["like"]=s;break}}return t},getFacebookData:function(){var e=document,t=e.createElement("script"),n=["id","username","name","about","mission","cover","picture","link","likes","checkins","talking_about_count"];t.src="https://graph.facebook.com/"+this.udata.href+"?fields="+n.join(",")+"&callback=FBcallback";e.body.appendChild(t)},setFacebookData:function(e){try{this.fbdata=[];for(var t in e){this.fbdata[t]=typeof e[t]=="object"?e[t].source||e[t].data.url:e[t].toString()}}catch(n){errorHandler(n,"no valid data")}this.createTemplate()},setBadgeTheme:function(){this.badge.setAttribute("class",this.udata.theme)},createTemplate:function(){var e=document,t=this.badge,n=this.udata.width-2,r=Math.floor(n/98)*12+Math.floor(n/100+10)*10,i=this.udata,s=this.fbdata,o=(s.mission||s.about).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,""),u={},a={cover:{style:"background-image: url("+(s.cover||"")+"); height: "+r+"px"},picture:{a:{href:s.link,target:"_blank",img:{width:80,height:80,src:"https://graph.facebook.com/"+s.username+"/picture?width=80&height=80"}}},name:{a:{href:s.link,target:"_blank",html:s.name}},link:{html:"facebook.com/"+s.username},about:{html:o.length>this.bdata.descrlen?o.substring(0,this.bdata.descrlen)+"...":o},button:{iframe:{"class":i.like,src:"http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Ffacebook.com%2F"+s.username+"&width&layout=button&action=like&show_faces=false&share=false&height=35&locale="+i.lang,scrolling:"no",frameborder:"no",allowTransparency:"true"}},likes:{span:{html:s.likes.replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1,")}}};if(this.browser.isIE()&&this.browser.isIE()<10&&s.cover.length>0){a["cover"]={img:{style:"width: "+(n+r)+"px !important; height: auto !important; margin-left: -"+r/2+"px;",src:s.cover}}}t.style.width=n+"px";for(var f in a){elem=a[f];for(var l in elem){u[f]=e.createElement("div");u[f].className="page-"+f;if(typeof elem[l]==="object"){var c=elem[l];u[f][l]=e.createElement(l);for(var h in c){if(typeof c[h]=="object"){addt=c[h];u[f][l][h]=e.createElement(h);for(var p in addt){u[f][l][h].setAttribute(p,addt[p])}u[f][l].appendChild(u[f][l][h])}else{if(h=="html"){u[f][l].innerHTML=c[h]}else{u[f][l].setAttribute(h,c[h])}}}u[f].appendChild(u[f][l])}else{if(l=="html"){u[f].innerHTML=elem[l]}else{u[f].setAttribute(l,elem[l])}}t.appendChild(u[f])}}},browser:{isIE:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("msie")!=-1?parseInt(e.split("msie")[1]):false}}};FBcallback=function(e){try{t.setFacebookData(e)}catch(n){errorHandler(n,"bad request")}};errorHandler=function(e,t){console.error(e,"FBplus Badge: "+t)};var t=new e;t.load()})()